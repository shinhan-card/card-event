# Card Event Intelligence 퍼블리시 가이드

## 1. GitHub에 올리기 (이미 완료)

코드를 공개 저장소에 올리는 방법입니다.

```powershell
cd card-event-intelligence
git init
git remote add origin https://github.com/shinhan-card/card-event.git
git add .
git config user.email "본인이메일"
git config user.name "본인이름"
git commit -m "Initial commit"
git branch -M main
git push -u origin main
```

이후 수정사항 반영:

```powershell
git add .
git commit -m "변경 내용 설명"
git push
```

---

## 2. 웹 서비스로 배포하기 (Render)

실제로 **누구나 접속할 수 있는 URL**로 서비스를 띄우려면 Render에서 배포합니다.

### 2-1. 준비물

- GitHub 계정 (저장소: https://github.com/shinhan-card/card-event)
- [Render](https://render.com) 계정 (무료 가입)
- **Google Gemini API 키** (대시보드 AI 인사이트용)

### 2-2. Render에서 배포하는 방법

1. **Render 로그인**  
   https://render.com → Sign Up / Log In (GitHub로 로그인 가능)

2. **Blueprint로 새 서비스 만들기**  
   - 대시보드에서 **New +** → **Blueprint**  
   - GitHub 저장소 **shinhan-card/card-event** 연결 (권한 허용)  
   - 저장소 선택 후 **Connect**  
   - `render.yaml`이 있으면 자동으로 서비스 설정이 채워짐

3. **환경 변수 설정**  
   - 생성된 Web Service 클릭 → **Environment**  
   - **GEMINI_API_KEY** 추가:  
     - Key: `GEMINI_API_KEY`  
     - Value: 본인의 [Google AI Studio](https://aistudio.google.com/apikey)에서 발급한 API 키  
   - 나머지(GEMINI_MODEL_PRIORITY, PORT 등)는 `render.yaml`에 이미 있으면 수정만 필요 시 변경

4. **디스크(Volume) 확인**  
   - `render.yaml`에 `disk` 설정이 있으면 SQLite DB가 `/var/data/events.db`에 저장됨  
   - Render 대시보드에서 해당 서비스의 **Disks**에 1GB 디스크가 붙어 있는지 확인

5. **배포**  
   - **Manual Deploy** → **Deploy latest commit**  
   - 또는 GitHub에 푸시하면 `autoDeploy: true` 설정으로 자동 배포됨

### 2-3. 배포 후 확인

- 서비스 URL: `https://<서비스이름>.onrender.com`
- 헬스 체크: `https://<서비스이름>.onrender.com/health` → `{"status":"healthy"}` 확인
- 대시보드: `https://<서비스이름>.onrender.com/` 접속 후 탭/차트 동작 확인

### 2-4. 참고 사항

| 항목 | 설명 |
|------|------|
| **무료 플랜** | 서비스가 일정 시간 미사용 시 슬립 → 첫 접속 시 30초~1분 정도 지연될 수 있음 |
| **Gemini API** | `GEMINI_API_KEY` 없으면 AI 인사이트만 비활성화되고, 나머지 기능은 동작 |
| **DB** | SQLite + Render 디스크 사용. 디스크 삭제 시 데이터 삭제됨 |

---

## 3. 다른 방식으로 퍼블리시하고 싶을 때

- **Docker만 쓰고 싶다**  
  - `Dockerfile`이 있으므로 `docker build -t card-event .` 후 `docker run -p 8000:8000 -e GEMINI_API_KEY=xxx card-event` 로 로컬/서버에서 실행 가능.

- **다른 클라우드(Vercel, Railway, Fly.io 등)**  
  - 이 프로젝트는 **Docker 기반**이므로 Docker를 지원하는 플랫폼에서 `Dockerfile`로 배포하면 됨.  
  - DB는 SQLite 대신 해당 플랫폼에서 제공하는 DB(PostgreSQL 등)로 바꾸려면 `database.py` 수정이 필요함.

- **내부망/회사 서버에만 공개**  
  - 서버에 코드 복사 후 `pip install -r requirements.txt`, `playwright install chromium`, `uvicorn app:app --host 0.0.0.0 --port 8000` 로 실행하면 됨.  
  - 방화벽에서 8000 포트만 허용하면 같은 네트워크 사용자가 접속 가능.

---

## 요약

| 목적 | 방법 |
|------|------|
| **코드만 공개** | GitHub에 푸시 (이미 완료) |
| **실제 웹 서비스 URL로 공개** | Render에서 Blueprint 배포 + `GEMINI_API_KEY` 설정 |

궁금한 점 있으면 `docs/OPERATIONS.md` 또는 `DEPLOY_RENDER.md`도 참고하세요.
