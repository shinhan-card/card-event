# PRD: 카드 이벤트 인텔리전스 고도화 (신한카드 마케터 중심)

버전: `v1.0`  
작성일: `2026-02-08`  
대상 서비스: `card-event-intelligence`  
핵심 원칙: **상세 iframe 수집/추출 플로우는 유지** (비목표로 명시)

---

## 1. 문제 정의

신한카드 마케터는 경쟁사(삼성/KB/현대) 이벤트를 매일 확인하지만, 현재 서비스는 운영 지표 중심(수집/추출/커버리지) 정보 비중이 높아 **즉시 전략 판단**에 필요한 정보 구조가 약하다.

특히 다음 5개가 핵심 문제다.

1. 오추출/누락 시 사람이 개입해 정정하는 워크플로우 부재  
2. 회사별/이벤트 유형별 비교가 제한적이고, 추출 텍스트 기반 비교가 약함  
3. 메인 화면이 마케터 의사결정보다 운영 모니터링 성격이 강함  
4. 신한(당사) vs 경쟁 3사 구분이 시각적으로 충분히 명확하지 않음  
5. 목록/상세 UI가 실무 탐색 순서(원본 → 추출 → AI)와 어긋남

---

## 2. 사용자와 JTBD

주 사용자: `신한카드 마케팅 담당자`

JTBD:
- 출근 후 5~10분 내 오늘 대응할 경쟁 이벤트를 찾고 우선순위를 정한다.
- 카테고리/혜택/대상/기간 관점에서 우리 카드 대비 공백(gap)을 확인한다.
- 회의 전에 “근거 텍스트가 포함된 비교표”를 바로 가져간다.

---

## 3. 비목표 (명시적 제외)

- 카드사 상세 페이지 수집 방식(iframe 대상 URL 열기, Playwright 추출)은 변경하지 않는다.
- 커넥터의 근본 구조(BaseConnector, 카드사별 crawl)는 이번 PRD 범위에서 대수술하지 않는다.

---

## 4. 현행 분석 (코드 근거)

### 4.1 강점 (유지할 것)

- 상세 추출 파이프라인은 안정적으로 분리됨  
  - `detail_extractor.py:730`  
  - `modules/extraction.py:14`  
  - `app.py:600`
- 섹션/인사이트 저장 모델이 이미 존재  
  - `database.py:93` (`EventSection`)  
  - `database.py:110` (`EventInsight`)
- 카드사별 커넥터 분리 구조가 명확  
  - `modules/connectors/*.py`

### 4.2 개선 포인트 (현재 한계)

- 수동 정정 API/UI 없음  
  - `app.py`에 이벤트 수정용 API가 `POST/DELETE` 외 사실상 부재 (`PATCH`/`PUT` 없음)
- 상세 모달 탭 순서가 실무 순서와 반대  
  - `templates/simple_dashboard.html:167-169` (`AI 분석 → 추출 내용 → 원본 페이지`)
- 필터 축이 제한적  
  - `static/js/dashboard.js:84-88`, `:329-342` (키워드/카드사/카테고리/상태)
- 메인 요약이 운영지표 비중 큼  
  - `templates/simple_dashboard.html:56-68` (KPI + 커버리지/최근추출)
- 백그라운드 “전체”의 의미가 추출 중심  
  - `modules/pipeline.py:247` (`run_full_pipeline`: 수집 생략)
- 오류를 200으로 반환하는 패턴 존재 (운영/관측성 리스크)  
  - `app.py:464-479`, `app.py:482-500`

---

## 5. 제품 목표

### 목표 A: 사람 개입형 품질 보정
- 오추출을 실무자가 1분 내 정정 가능
- 정정 이력과 근거를 추적 가능

### 목표 B: “비교 가능한 정보 구조”
- 회사/카테고리/혜택유형/조건 난이도 기준으로 비교
- 추출 원문 근거를 바로 확인 가능

### 목표 C: 신한 중심 의사결정 화면
- 메인에서 “당사 대비 위험/기회/권고 액션”이 가장 먼저 노출

---

## 6. 기능 요구사항 (Functional Requirements)

## Epic 1. Human-in-the-loop 정정 기능

### FR-1. 이벤트 수동 정정
- 이벤트 상세에서 다음 필드 직접 수정
  - `title`, `period`, `benefit_value`, `conditions`, `target_segment`
  - 섹션별 텍스트(`혜택_상세`, `참여방법`, `유의사항` 등)
  - 인사이트(`benefit_level`, `competitive_points`, `promo_strategies`)

### FR-2. 정정 이력 관리
- 누가/언제/무엇을 변경했는지 기록
- “원본 추출값 ↔ 최종 확정값” diff 제공

### FR-3. 재추출 충돌 정책
- 이벤트별 `확정 잠금(locked)` 옵션
- locked 이벤트는 재추출 시 수동 확정값을 덮어쓰지 않음

### 수용 기준
- 1건 정정 후 목록/모달/비교표에 즉시 반영
- 변경 이력 100% 조회 가능

---

## Epic 2. 비교 기능 확장 (텍스트 기반)

### FR-4. 비교 매트릭스 확장
- 축: `카드사 x 카테고리`, `카드사 x 혜택유형`, `카드사 x 타겟유형`, `카드사 x 전략태그`

### FR-5. 추출 텍스트 기반 비교
- 섹션 텍스트를 기준으로:
  - 공통 문구(commodity) vs 차별 문구(differentiator)
  - 고빈도 조건 패턴(예: 최소 결제금액, 월 한도, 선착순)

### FR-6. 신한 대비 갭 뷰
- “경쟁사만 강한 구간” 자동 표시
- 예: `여행/고가할부/장기 프로모션`에서 신한 미대응 표시

### 수용 기준
- 비교 화면에서 카드사 4개, 카테고리 5개 이상 교차 필터링 가능
- 각 인사이트에 원문 근거 클릭 이동 제공

---

## Epic 3. 메인 화면 리뉴얼 (마케터 우선)

### FR-7. 메인 구조 재배치
- 제거/축소: 운영 KPI(수집/추출/커버리지) 상단 대형 노출
- 강화: 아래 3개 우선 노출
  1. `오늘의 대응 필요 이벤트`  
  2. `신한 대비 리스크 히트맵`  
  3. `이번 주 경쟁사 전략 변화`

### FR-8. 운영 정보의 분리
- 수집/추출/잡 상태는 별도 “운영 탭” 또는 접이식 패널로 이동

### 수용 기준
- 메인 첫 화면에서 3개 액션 카드와 근거 이벤트 링크가 보임

---

## Epic 4. 시각 체계 고도화 (당사 vs 경쟁사)

### FR-9. 브랜드 레이어 구분
- 당사(신한) 영역은 고정 강조(프라이머리 블루, 고정 열/고정 배지)
- 경쟁 3사는 동일 위계의 비교군으로 노출

### FR-10. 비교 화면 표준화
- 모든 차트/테이블에서 `신한 → KB → 삼성 → 현대` 순서 고정
- 범례/배지 일관성 확보

### 수용 기준
- 동일 데이터라도 신한 위치와 스타일이 화면마다 일관됨

---

## Epic 5. 목록/상세 탐색 UX 개선

### FR-11. 목록 필터 확장
- 추가 필터:
  - 혜택 유형/금액 구간/할인율 구간
  - 추출 품질(완료/수동정정/미완료)
  - 파트너십 포함 여부
  - 태그(신규유치/리텐션/디지털전환 등)

### FR-12. 상세 탭 순서 변경
- 현재: `AI 분석 → 추출 내용 → 원본 페이지`
- 변경: `원본 페이지 → 추출 내용 → AI 분석`
  - 근거 확인 후 해석하는 실무 흐름 반영

### FR-13. 빠른 비교 액션
- 목록 행에서 “비교 담기” 체크 후 다건 비교 모달 오픈

### 수용 기준
- 3개 필터 이상 조합 시 응답 2초 내
- 모달 기본 탭이 원본 페이지로 열림

---

## 7. 비기능 요구사항 (NFR)

- 성능: 이벤트 1,000건 기준 목록 필터 응답 2초 이내
- 안정성: 추출 실패 이벤트는 UI에서 재시도/수동정정 모두 가능
- 감사가능성: 수동정정 로그 누락 0건
- 관측성: 실패는 4xx/5xx로 명확 반환, 대시보드는 별도 상태 메시지 표시

---

## 8. 데이터/아키텍처 변경 제안

### 신규 테이블
- `event_manual_edits`
  - `id`, `event_id`, `field_name`, `old_value`, `new_value`, `editor`, `edited_at`, `reason`
- `event_curation_state`
  - `event_id`, `is_locked`, `locked_by`, `locked_at`, `lock_reason`

### API 제안
- `PATCH /api/events/{id}/manual-update`
- `GET /api/events/{id}/edit-history`
- `POST /api/events/{id}/lock`
- `GET /api/analytics/compare-matrix`
- `GET /api/analytics/shinhan-gap`

---

## 9. 화면 IA 제안

- `경영 요약` -> `전략 브리핑` (리스크/기회 중심)
- `카드사 비교` -> 유지 + 비교 축 확장
- `혜택 벤치마크` -> 유지 + 구간 필터
- `전략 맵` -> 유지 + 신한 갭 레이어
- `이벤트 목록` -> 고급 필터 + 수동정정 진입
- `운영 상태(신규)` -> 수집/추출/잡 모니터링 이동

---

## 10. KPI

1. 마케터 Daily 리뷰 시간: `-30%`
2. 오추출 정정 리드타임: `5분 -> 1분 이내`
3. 추출 신뢰도(수동정정 필요 이벤트 비율): `월 20% 감소`
4. 신한 대비 대응안 작성 소요시간: `-40%`

---

## 11. 릴리즈 계획 (권장)

### Phase 1 (2주): 실무 효율 핵심
- 수동정정 API/화면
- 상세 탭 순서 변경
- 목록 필터 확장(혜택/추출상태/태그)

### Phase 2 (2주): 전략 비교 강화
- 비교 매트릭스 확장
- 신한 갭 뷰
- 메인 전략 브리핑 리뉴얼

### Phase 3 (1~2주): 운영 안정화
- 감사로그/락 정책 고도화
- 관측성/에러코드 정리
- 성능 튜닝

---

## 12. 리스크와 대응

- Gemini RPM 제한(5/min)으로 실시간 재추론 지연 가능  
  - 대응: 캐시 + rule fallback + 강제 재추론 큐잉
- 카드사 DOM 변경으로 섹션 품질 변동  
  - 대응: 수동정정 + 도메인별 셀렉터 모니터링
- 현재 예외를 200으로 반환하는 관행으로 장애 탐지 지연 가능  
  - 대응: 파이프라인 API 응답 표준화(성공/실패 HTTP 코드 분리)

---

## 13. 즉시 실행 가능한 개발 백로그 (Top 10)

1. 모달 탭 순서 변경 (원본→추출→AI)
2. 이벤트 수동정정 API 1차
3. 이벤트 수동정정 모달 UI
4. 정정 이력 조회 API
5. 이벤트 잠금/재추출 충돌 정책
6. 목록 고급 필터(혜택유형/금액/태그/정정상태)
7. 비교 매트릭스 API 확장
8. 신한 대비 갭 카드 생성
9. 메인 화면 운영 KPI 축소/분리
10. 에러코드/관측성 정리

---

## 14. 결론

현재 시스템은 “수집·추출 인프라”는 충분히 갖춰져 있다.  
다음 단계의 핵심은 **마케터 의사결정 UX + 수동 품질보정 + 비교 해상도 강화**다.

본 PRD는 기존 추출 구조를 보존하면서, 신한카드 실무 목적(빠른 대응 판단)에 맞는 제품으로 전환하기 위한 실행 기준이다.
